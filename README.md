# Churn prediction API
This project sought to implement a fully functioning API, capable of producing customer churn predictions with a single HTTP request. The underlying ML model: A simple FCNN, was created and trained using PyTorch. The API is created using FastAPI. 

In the above source code, the folder `app` contains the complete API, which is ready for deployment out of the box. Inside this folder, a Jupyter Notebook `FCNN.ipynb`, details the training of the underlying model, if the user should wish to perform alterations in any way.

The following README file seeks to present the churn prediction problem, before presenting how one can run the API locally and/or alter the underlying model/data.

# The customer churn prediction problem
Predicting customer churn rates can be defined as a binary classification problem: Given data on a customer, will that customer be retained or ultimately cancel their business relationship (churn)? Due to the inherently complex nature of said relationships, the problem proves to be fairly challenging, which in turn makes good predictions desireable for modern businesses. 

This application does not seek to present the best performing estimator to the customer churn problem, but rather a comprehensive framework for how solutions can be developed and deployed using state of the art methods in Machine Learning (ML) and API design. 

# Running the API
To run the existing API, open a terminal in the `app` directory and start a Uvicorn server instance: `uvicorn app:app --reload` (`--reload` should be omitted for final deployment). Upon instantiation, the server yields a local port on which it is listening for user-requests. 

Using the SwaggerUI docs (autogenerated by FastAPI) or an API service like [Postman](https://www.postman.com/), churn predictions can be made by submitting requests consisting of customer data on a JSON format. Some arbitrary customer data may look as follows: 

```json
{
  "customerID": "ID42",
  "gender": "Female",
  "SeniorCitizen": "No",
  "Partner": "Yes",
  "Dependents": "No",
  "tenure": 1,
  "PhoneService": "Yes",
  "MultipleLines": "No",
  "InternetService": "No",
  "OnlineSecurity": "No internet service",
  "OnlineBackup": "No internet service",
  "DeviceProtection": "No internet service",
  "TechSupport": "No internet service",
  "StreamingTV": "No internet service",
  "StreamingMovies": "No internet service",
  "Contract": "Month-to-month",
  "PaperlessBilling": "No",
  "PaymentMethod": "Electronic check",
  "MonthlyCharges": 30,
  "TotalCharges": 30
}
```

For this instance, the model should return the following responce: `"churn": "Yes"`.

# Altering the underlying model/dataset
The source code contains a working API as well as a modular program to refactor and retrain the underlying ML models. Below follows an introductory guide to how one can alter everything from training/test data to the final estimator.

## The churn dataset
The above source code does not contain the adopted dataset. The publicly available [Telco cutomer churn dataset](https://www.kaggle.com/datasets/blastchar/telco-customer-churn/data) can be downloaded and extracted into a new subdirectory `app/data/WA_Fn-UseC_-Telco-Customer-Churn.csv` for seamless integration.

The dataset is preprocessed using a modular, exportable `sklearn.Pipeline`, which can be inspected and altered in `app/pipelines/Preprocessing.py`.

## The ML model
In this project, a simple Fully Connected Neural Network (FCNN) is adopted to estimate the binary customer churn problem. A Jupyter Notebook `app/FCNN.ipynb` highlights how the model, located in `app/ml_models/models/FCNN.py`, is trained and ultimately exported for real-time deployment as part of the API. Any changes to the model or training/test loops should be done here. 
